DROP DATABASE IF EXISTS gos_uslugi;
CREATE DATABASE gos_uslugi;

USE gos_uslugi;




DROP TABLE IF EXISTS region;
CREATE TABLE region(
id SERIAL PRIMARY KEY,
region VARCHAR(150),
city VARCHAR(150),
INDEX region_idx(region),
INDEX region1_idx(city)
);



INSERT INTO region(region,city) VALUES
('Белгородская область','Белгород'),
('Белгородская область','Старый Оскол'),
('Белгородская область','Алексеевка'),
('Брянская область','Брянск'),
('Брянская область','Карачаев'),
('Брянская область','Унеча'),
('Владимирская область','Суздаль'),
('Владимирская область','Владимир'),
('Владимирская область','Александров'),
('Воронежская область','Воронеж'),
('Воронежская область','Лиски'),
('Воронежская область','Павловск'),
('Ивановская область','Иваново'),
('Ивановская область','Южа'),
('Ивановская область','Плес'),
('Калужская область','Калуга'),
('Калужская область','Обнинск'),
('Калужская область','Таруса'),
('Московская область','Химки'),
('Московская область','Мытищи'),
('Московская область','Серпухов'),
('Орловская область','Орел'),
('Орловская область','Болхов'),
('Орловская область','Ливны'),
('Рязанская область','Рязань'),
('Рязанская область','Скопин'),
('Рязанская область','Касимов'),
('Смоленская область','Смоленск'),
('Смоленская область','Вязьма'),
('Смоленская область','Ельня'),
('Тамбовская область','Тамбов'),
('Тамбовская область','Мичуринск'),
('Тамбовская область','Котовск'),
('Краснодарский край','Краснодар'),
('Краснодарский край','Сочи'),
('Краснодарский край','Анапа'),
('Ставропольский край','Ставрополь'),
('Ставропольский край','Пятигорск'),
('Ставропольский край','Кисловодск'),
('Астраханская область','Астрахань'),
('Астраханская область','Ахтубинск'),
('Астраханская область','Знаменск'),
('Волгоградская область','Волгоград'),
('Волгоградская область','Камышин'),
('Волгоградская область','Волжский'),
('Ростовская область','Ростов-на-Дону'),
('Ростовская область','Шахты'),
('Ростовская область','Гуково'),
('Пензенская область','Пенза'),
('Пензенская область','Кузнецк'),
('Пензенская область','Каменка');


DROP TABLE IF EXISTS SNILS ;
CREATE TABLE SNILS(
    id SERIAL PRIMARY KEY,
    number_of VARCHAR(100),
    date_of DATE  COMMENT 'Дата выдачи',
    status_of_verification ENUM('в обработке','принято','отказано'),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
 INDEX SNILS_idx(number_of,date_of),
 INDEX status_SN_idx(status_of_verification)
   );
  
  
 INSERT INTO SNILS(id,number_of,date_of,status_of_verification,created_at,updated_at) VALUES
('101', '36-91-867', '2014-04-29', 'в обработке', '2019-08-24 05:48:41', '2020-02-13 02:19:21'),
('102', '71-56-767', '2013-03-08', 'в обработке', '2015-02-23 01:02:34', '2016-04-12 13:15:55'),
('103', '27-67-729', '2015-06-10', 'принято', '2017-10-24 18:11:43', '2018-07-26 11:50:44'),
('104', '16-45-334', '2020-08-15', 'в обработке', '2019-10-31 19:48:36', '2020-04-02 21:52:19'),
('105', '75-75-344', '2017-12-09', 'отказано', '2010-03-18 09:12:52', '2010-06-27 16:44:34'),
('106', '89-56-246', '2003-08-23', 'в обработке', '2019-05-10 08:40:59', '2020-03-04 16:48:08'),
('109', '84-47-456', '2005-07-14', 'в обработке', '2011-11-10 05:13:04', '2012-03-02 04:17:58'),
('110', '31-86-234', '2016-12-18', 'в обработке', '2018-12-01 23:22:55', '2020-07-20 08:09:33'),
('111', '94-46-448', '2018-03-18', 'в обработке', '2018-09-06 02:42:02', '2020-05-25 00:14:59'),
('112', '58-68-236', '2016-11-30', 'принято', '1990-08-10 08:30:12', '2020-09-02 03:06:05'),
('113', '46-66-279', '2009-03-03', 'в обработке', '1990-04-18 08:23:51', '2020-03-11 19:29:55'),
('114', '19-86-829', '2013-01-13', 'отказано', '2014-12-10 19:51:47', '2020-04-06 04:03:08'),
('115', '15-86-829', '2013-01-13', 'отказано', '2014-12-10 19:51:47', '2020-04-06 04:03:08'),
('116', '38-30-927', '2014-01-31', 'отказано', '2018-11-14 05:09:17', '2020-06-11 02:59:58'),
('117', '43-18-436', '2015-11-19', 'принято', '2001-02-24 14:58:50', '2020-11-20 08:30:27'),
('118', '43-18-436', '2015-11-19', 'принято', '2001-02-24 14:58:50', '2020-11-20 08:30:27'),
('119', '43-18-436', '2015-11-19', 'принято', '2001-02-24 14:58:50', '2020-11-20 08:30:27'),
('120', '44-66-279', '2009-03-03', 'в обработке', '2019-04-18 08:23:51', '2020-03-11 19:29:55'),
('121', '46-96-279', '2009-03-03', 'в обработке', '2019-04-18 08:23:51', '2020-03-11 19:29:55'),
('122', '46-62-279', '2009-03-03', 'в обработке', '2019-04-18 08:23:51', '2020-03-11 19:29:55'),
('123', '17-14-098', '2016-04-30', 'принято', '2019-02-24 04:09:57', '2020-08-31 05:22:47'),
('124', '77-14-098', '2016-04-30', 'принято', '2019-02-24 04:09:57', '2020-08-31 05:22:47'),
('125', '11-14-098', '2016-04-30', 'принято', '2019-02-24 04:09:57', '2020-08-31 05:22:47'),
('126', '17-14-658', '2016-04-30', 'принято', '2019-02-24 04:09:57', '2020-08-31 05:22:47'),
('127', '19-68-365', '2016-04-05', 'отказано', '2019-05-21 15:45:45', '2020-07-26 21:27:20'),
('128', '17-68-365', '2016-04-05', 'отказано', '2019-05-21 15:45:45', '2020-07-26 21:27:20'),
('129', '27-67-953', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('130', '69-91-772', '2015-10-11', 'отказано', '2019-03-21 15:40:16', '2020-05-25 02:40:39'),
('131', '27-97-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('132', '27-67-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('133', '27-45-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('134', '91-68-446', '2012-02-01', 'отказано', '2019-04-08 09:22:15', '2020-02-09 02:40:07'),
('135', '22-45-440', '2018-11-16', 'принято', '2019-04-08 08:52:42', '2020-03-04 10:01:26'),
('136', '27-87-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('137', '32-23-556', '2019-04-03', 'отказано', '2019-01-01 12:55:25', '2020-03-16 05:10:45'),
('138', '17-67-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('139', '77-67-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('140', '27-67-123', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('141', '79-67-353', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('142', '47-86-422', '2019-08-21', 'отказано', '2019-04-04 12:32:47', '2020-02-10 07:31:55'),
('143', '12-67-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('144', '58-58-156', '2008-07-06', 'отказано', '2019-05-09 11:25:14', '2020-01-07 08:04:45'),
('145', '27-21-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('146', '26-06-977', '2012-06-10', 'в обработке', '2019-10-25 10:34:32', '2020-03-31 22:17:26'),
('147', '79-45-655', '2011-07-22', 'в обработке', '2019-11-30 22:20:02', '2020-06-05 05:47:36'),
('148', '27-67-125', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('149', '27-64-623', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('150', '68-37-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('151', '93-36-344', '2007-08-04', 'принято', '2019-02-21 23:37:08', '2020-01-14 03:28:06'),
('152', '58-76-389', '2008-09-07', 'принято', '2019-12-13 17:31:34', '2020-07-14 05:18:43'),
('153', '27-87-543', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('154', '46-68-623', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('155', '12-56-653', '2013-08-03', 'принято', '2019-04-11 04:47:10', '2020-05-06 00:44:26'),
('156', '44-45-230', '2010-02-09', 'в обработке', '2019-03-26 06:04:03', '2020-10-19 21:30:36'),
('157', '12-55-178', '2011-11-15', 'отказано', '2019-07-29 15:46:48', '2020-03-21 18:09:00'),
('158', '62-05-884', '2015-11-19', 'принято', '2019-02-04 08:46:35', '2020-10-05 18:12:33'),
('159', '39-34-879', '2017-06-15', 'принято', '2019-10-12 03:26:20', '2020-03-31 06:52:54'),
('160', '36-19-892', '2018-07-12', 'принято', '2019-01-20 16:07:23', '2020-03-11 18:38:51'),
('161', '39-11-892', '2018-07-12', 'принято', '2019-01-20 16:07:23', '2020-03-11 18:38:51'),
('162', '62-66-785', '2005-04-22', 'принято', '2019-05-16 01:08:05', '2020-06-26 10:46:38'),
('163', '39-97-792', '2016-07-12', 'принято', '2019-01-20 16:07:23', '2020-03-11 18:38:51'),
('164', '36-19-292', '2017-07-12', 'принято', '2019-01-20 16:07:23', '2020-03-11 18:38:51'),
('165', '31-45-692', '2017-07-12', 'принято', '2019-01-20 16:07:23', '2020-03-11 18:38:51'),
('166', '39-19-892', '2019-07-12', 'принято', '2012-01-20 16:07:23', '2020-03-11 18:38:51'),
('167', '74-46-687', '2018-10-19', 'отказано', '1984-05-09 22:17:19', '2020-10-19 02:48:51'),
('168', '43-64-876', '2019-01-02', 'принято', '2001-09-18 11:46:04', '2020-10-28 06:58:24'),
('169', '26-66-781', '2020-02-06', 'принято', '2020-06-10 05:41:23', '2021-12-07 07:03:42'),
('170', '33-64-879', '2016-01-18', 'в обработке', '2016-02-08 07:25:35', '2020-03-28 07:13:45'),
('171', '59-05-023', '2012-11-24', 'в обработке', '2012-11-25 07:08:54', '2021-08-30 13:17:56'),
('172', '18-19-832', '2019-07-12', 'принято', '2020-01-20 16:07:23', '2020-03-11 18:38:51'),
('173', '82-56-657', '2021-03-30', 'принято', '2021-08-04 17:36:22', '2021-11-14 09:22:14'),
('174', '30-12-894', '2019-07-12', 'принято', '2020-01-20 16:07:23', '2020-03-11 18:38:51'),
('175', '41-01-718', '2017-10-29', 'в обработке', '2018-03-13 11:10:19', '2018-12-25 22:47:42'),
('176', '49-78-766', '2018-09-22', 'в обработке', '2018-10-05 21:45:33', '2020-07-26 17:45:13'),
('177', '40-72-028', '2017-04-27', 'принято', '2018-02-03 08:53:44', '2020-12-09 18:43:29'),
('178', '85-35-139', '2019-02-25', 'принято', '2019-03-12 18:39:53', '2021-05-22 03:07:20'),
('179', '94-96-899', '2019-03-16', 'принято', '2019-04-13 09:14:59', '2020-03-17 13:39:58'),
('180', '21-39-601', '2017-06-13', 'принято', '2017-10-20 03:27:25', '2020-01-27 15:16:42'),
('181', '11-43-467', '2019-04-05', 'принято', '2020-12-24 13:08:47', '2021-01-05 19:53:31'),
 ('182', '33-20-325', '2012-12-03', 'отказано', '2013-07-03 14:39:38', '2021-10-26 18:43:21'),
 ('183', '59-33-757', '2018-08-30', 'принято', '2012-06-06 19:28:28', '2021-09-15 23:00:55'),
 ('184', '43-45-336', '2016-09-23', 'в обработке', '2017-02-08 04:53:40', '2020-01-23 08:59:45'),
 ('185', '26-68-989', '2021-06-03', 'принято', '2021-06-03 10:36:53', '2021-07-09 07:48:44'),
('186', '50-36-764', '2010-07-14', 'отказано', '2011-06-29 19:23:27', '2020-05-12 01:01:12'),
('187', '30-56-646', '2017-01-09', 'в обработке', '2016-05-11 03:59:06', '2020-02-19 07:31:06'),
('188', '37-45-653', '2016-02-12', 'отказано', '2016-12-26 03:35:13', '2021-10-01 06:43:10'),
('192', '11-43-567', '2019-07-28', 'принято', '2020-08-08 17:26:11', '2020-12-16 18:03:10'),
('193', '11-75-688', '2019-01-31', 'в обработке', '2019-06-17 12:33:08', '2020-07-15 17:06:37'),
('197', '32-41-701', '2015-02-25', 'принято', '2016-06-24 23:47:31', '2020-05-14 04:55:40'),
('198', '66-76-691', '2017-01-19', 'в обработке', '2018-09-21 15:01:42', '2020-08-15 20:03:01'),
('200', '11-43-217', '2018-11-24', 'в обработке', '2019-01-11 18:36:06', '2020-05-29 14:22:10');






DROP TABLE IF EXISTS users;
CREATE TABLE users (
	id SERIAL PRIMARY KEY ,
    lastname VARCHAR(100),
    firstname VARCHAR(100),
    patronymic VARCHAR(100)  COMMENT 'Отчество',
    gender CHAR(1),
    birthday DATE,
    region_id  BIGINT UNSIGNED NOT NULL,
    INN VARCHAR(100) NOT NULL UNIQUE,       
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(100),
    phone BIGINT UNSIGNED NOT NULL,
    snils_id BIGINT UNSIGNED NOT NULL,
FOREIGN KEY (region_id) REFERENCES region(id) ON UPDATE CASCADE ON DELETE CASCADE, 
FOREIGN KEY (snils_id) REFERENCES snils(id) ON UPDATE CASCADE ON DELETE CASCADE,
INDEX user_phone_idx(phone),
INDEX user_email_idx(email),
INDEX INN_idx(INN)
);
   
 INSERT INTO users(lastname,firstname,patronymic,gender,birthday,region_id,INN, email,password_hash, phone, snils_id) VALUES
 ('Игнатов','Рашид', 'Тигрович','m','1994-03-01',1,'654-321-554','breanne.okuneva@example.net','2f65eeb44c9','60547973',101),
 ('Аксёнов', 'Савелий', 'Алексеевич','m','1971-12-19',51,'142-521-452', 'norma.feeney@example.net','cg16473973','110064719',102),
 ('Репина', 'Есения', 'Витальевна','f', '2001-12-25',2,'145-563-145','monty.fisher@example.com','u25809756','106665612',103),
 ('Лебедева', 'Нора', 'Артемовна','f','1987-09-23',3,'018-450-543','eddie54@example.net','jk45247392','105582911',104),
 ('Лазарев', 'Антон', 'Денисович','m','1998-03-13',4,'148-630-255','yvonne.block@example.com','h57090016','105891686',105),
('Волков', 'Геннадий', 'Александрович','m','2002-02-16'	,5,'146-053-214','xgorczany@example.com','o76661662','111039559',106),
('Бодров', 'Николай', 'Семенович','m','2003-08-27',6,'237-456-789','ebogan@example.net','4lk2533221','106436738',163),
('Щербаков', 'Анатолий', 'Николаевич','m','2001-01-04',7,'452-679-890','providenci85@example.org','59255208k','108170132',164),
('Воронов', 'Григорий', 'Михайлович','m','1982-06-12',8,'141-630-452','johns.dorothy@example.net','9ee76792d3','34975438',109),
('Черкасова', 'Валентина', 'Анатольевна','f','2000-05-18',9,'123-456-709','ozella.mraz@example.org','a383002f3b8','23452425',110),
('Дегтярева', 'Яна', 'Валерьевна','f','2001-12-25',10,'128-456-709','reed.franecki@example.net','08d4b492485','123456901',111),
('Волкова', 'Полина', 'Геннадьевна','f','1989-01-22',11,'123-476-709','nia.labadie@example.net','696fcc8baedead','45678429',112),
('Быкова', 'Екатерина', 'Сергеевна','f','2000-10-07',12,'103-456-709','naufderhar@example.com','63fc482caac0ccc6','12345679',113),
('Коновалов', 'Андрей', 'Сергеевич','m','1957-07-28',13,'123-456-609','fsenger@example.com','d78ae8822ff7','678987091',114),
('Базарова', 'Оксана', 'Андреевна','f','1976-06-11',14,'223-456-709','wilfred83@example.org','f1541b36b664','9876593',115),
('Самойлов', 'Александр', 'Михайлович','m','1995-08-10',15,'147-521-452', 'sonny.howe@example.com','7014318b0634','7637864',116),
('Белова', 'Вера', 'Егоровна','f','1982-12-14',16,'142-521-482','helmer46@example.org','dca7e2a9e63ea23d3e1d8','3557181',117),
('Капустин', 'Евгений', 'Васильевич','m','1970-11-04',17,'146-521-452','skulas@example.net','e57533be4276b918486','7863958',118),
('Давыдова', 'Софья', 'Евгеньевна','f','1997-04-10',18,'142-527-452','heller.maudie@example.com','c92d761c87f9ea7','2647805',119),
('Захарова', 'Лидия', 'Михайловна','f','1996-12-22',19,'143-521-452', 'rudolph30@example.com','441d1bd57e072ac331','8939743',120),
('Галкин', 'Андрей', 'Васильевич','m','2000-02-13',20,'192-521-452', 'tillman.jazmyne@example.com','8e98e661e931e7','9476569',121),
('Фомин', 'Георгий', 'Васильевич','m','2002-03-29',21,'694-321-554','emilie85@example.com','f29f08c72a6c19','987653450',122),
('Крюков', 'Евгений', 'Семенович','m','1995-07-11',22,'654-321-584','maxie56@example.org','5f17afbf19fc522d6','86550096',123),
('Ильина', 'Зоя', 'Александровна','f','1993-02-12',23,'654-321-504','qbeer@example.org','3c288d8af3b0e','347887656',124),
('Маслова', 'Диана', 'Анатольевна','f','1994-05-03',24,'674-621-554','khalid97@example.com','aed6e7e772f8','135007554',125),
('Юрьева', 'Валентина', 'Сергеевна','f','2004-08-20',25,'655-421-554','xorn@example.net','0c9926bcde3','797645422',126),
('Рожков', 'Никита', 'Денисович','m','1989-01-16',26,'954-821-554','pkiehn@example.com','48e3623610371f','1490461455',127),
('Ибрагимов', 'Аркадий', 'Семенович','m','1988-05-11',27,'654-021-554','krohan@example.com','0d4ca0ae6cae042cc2756','9638931',128),
('Логинов', 'Эдуард', 'Михайлович','m','1997-11-16',28,'024-321-554','felton30@example.com','909ffc0b4b63f98','94745975',129),
 ('Репин', 'Виктор', 'Степанович','m','1987-07-16',29,'654-321-503','chris.pfannerstill@example.org','3f114fd760169be','98765456',130),
 ('Лебедева', 'Маргарита', 'Артемовна','f','2011-12-16',30,'254-021-554','myrtie.block@example.com','c6384986','9876685',131),
('Лазарев', 'Андрей', 'Денисович','m','1995-01-09',31,'134-521-554','tsauer@example.net','efdb49d3415c','8764561',132),
('Волков', 'Михаил', 'Александрович','m','1987-06-27',32,'697-121-554','novella81@example.com','ba5736dba0a','8269625',133),
('Бодров', 'Артем', 'Семенович','m','1976-05-12',33,'444-321-554','botsford.valerie@example.com','89899a8ecf1','79310540',134),
('Щербаков', 'Виталий', 'Николаевич','m','1995-02-12',34,'654-222-554','shea35@example.org','f84b64daf0aad','8765272',135),
('Воронов', 'Вячеслав', 'Михайлович','m','2002-12-22',35,'654-321-555','upton.eldora@example.com','808a7ce058a767','7761206',136),
('Черкасова', 'Алена', 'Анатольевна','f','1971-01-08',36,'654-111-554','emily.ritchie@example.com','540c32051e0222','78089873',137),
('Дегтярева', 'Светлана', 'Анатольевна','f','1989-06-12',37,'633-321-554','goodwin.ellen@example.com','e871994a9','8611570',138),
('Волкова', 'Полина', 'Евгеньевна','f','2002-11-22',38,'154-121-154','elesch@example.org','e54744cb','17866664',139),
('Быкова', 'Ольга', 'Сергеевна','f','1996-02-20',39,'454-421-454','adrain.homenick@example.com','db17ee8d9','14885311',140),
('Коновалов', 'Игорь', 'Сергеевич','m','2000-02-04',40,'354-321-354','camden.hansen@example.com','1cd1ab6b4b3','7884611',141),
('Базарова', 'Оксана', 'Вячеславовна','f','1995-10-19',41,'754-721-754','mfarrell@example.net','13578ee9141e064','84315093',142),
('Самойлов', 'Артем', 'Русланович','m','1983-03-20',42,'854-821-850','botsford.sandra@example.com','dac90f388f3d','877795',143),
('Белова', 'Лидия', 'Егоровна','f','2001-12-30',43,'604-301-504','vicky15@example.net','5a394eb552c591372d8512','1434150',144),
('Капустин', 'Дмитрий', 'Игоревич','m','1986-12-27',44,'634-331-534','kattie.hoppe@example.net','2e60c771850fc3c82d','7431501',145),
('Давыдов', 'Леонид', 'Евгеньевич','m','1993-06-23',45,'154-311-154','elesch@example.net','364a20ae232','1514350',146),
('Захаров', 'Виктор', 'Михайлович','m','1976-05-17',46,'554-371-854','ken86@example.net','086ebf66cd9005d2','49431504',147),
('Галкин', 'Петр', 'Васильевич','m','1978-03-17',47,'954-321-954','cronin.walton@example.com','b41eb7a95d0b1811db31ee','97431502',148),
('Черкасов', 'Алексей', 'Владимирович','m','1995-09-06',48,'454-521-654','agulgowski@example.com','6316c1c58cba4858b5','4315005',149),
('Дегтярев', 'Святослав', 'Валерьевич','m','1994-12-04',49,'154-221-354','carley10@example.com','22ba78bb6e8897e','488453112',150),
('Волков', 'Василий', 'Владимирович','m','1975-06-22',50,'554-621-754','qmills@example.net','c7610f69f62','8043150',151),
('Быкова', 'Ольга', 'Сергеевна','f','1972-11-11',51,'854-921-054','whessel@example.org','4d82fa00392','5463732',152),
('Коновалов', 'Дмитрий', 'Сергеевич','m','1996-11-27',1,'054-121-254','ebert.vilma@example.org','2c6fa2c2ff97164af','94315039',153),
('Базаров', 'Олег', 'Андреевич','m','1962-07-15',23,'354-421-354','bartell.louisa@example.com','2a02f054b23490755e','44315062',154 ),
('Самойлова', 'Александра', 'Руслановна','f','1976-02-07',18,'254-421-584','pablo.moen@example.com','c6d9ee795da600d66ed3','86431501',155),
('Белова', 'Ирина', 'Сергеевна','f','1974-10-04',21,'204-021-354','mkertzmann@example.net','d5f390c70e6','1043150',156),
('Капустин', 'Юрий', 'Дмитриевич','m','1998-12-09',30,'304-091-754','yskiles@example.com','00140950759fd627','67431502',157),
('Давыдов', 'Сергей', 'Петрович','m','1994-07-13',34,'101-521-054','little.rahsaan@example.com','265ed053f','22043150',158),
('Захарова', 'Валентина', 'Михайловна','f','1973-01-24',29,'731-321-554','grady.domenica@example.net','a0c765182cdcd227d262','97043150',159),
('Галкин', 'Артур', 'Георгиевич','m','1988-03-10',36,'654-321-196','veum.silas@example.org','e0ab6b0a84f3','33143150',160),
('Крюкова', 'Светлана', 'Артуровна','f','1997-08-17',37,'654-324-554','loraine44@example.com','a22edf0220e8693f3','2143150',161),
('Аксёнова', 'Алина', 'Юрьевна','f','2000-10-11',9,'111-321-554','cortney20@example.com','d1fb3e1bd1cdad06','9143150',162);



-- Дети до 14 лет(без паспорта)

DROP TABLE IF EXISTS children;
CREATE TABLE children( 
    id SERIAL PRIMARY KEY ,
    user_id BIGINT UNSIGNED NOT NULL  COMMENT 'Родитель',
    lastname VARCHAR(100),
    firstname VARCHAR(100),
    patronymic VARCHAR(100)  COMMENT 'Отчество',
    gender CHAR(1),
    birthday DATE,
    birth_certificate VARCHAR(100) NOT NULL UNIQUE,
    snils_id BIGINT UNSIGNED NOT NULL,
    Polis_med INT NOT NULL UNIQUE,
FOREIGN KEY (user_id) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
FOREIGN KEY (snils_id) REFERENCES snils(id) ON UPDATE CASCADE ON DELETE CASCADE,
INDEX birth_cer_idx(birth_certificate),
INDEX polis_idx(Polis_med)
);

INSERT INTO children(user_id,lastname,firstname,patronymic,gender, birthday,birth_certificate,snils_id, Polis_med) VALUES
(7,'Бодров', 'Николай', 'Николаевич','m','2017-08-27','4lk2533221',165,'106436738'),
(8,'Щербаков', 'Анатолий', 'Анатольевич','m','2019-01-04','59255208k',166,'108170132'),
(7,'Бодров', 'Григорий', 'Григорьевич','m','2018-06-12','9ee76792d3',167,'34975438'),
(10,'Черкасова', 'Валентина', 'Григорьевна','f','2019-05-18','a383002f3b8',168,'23452425'),
(11,'Дегтярева', 'Алиса', 'Сергеевна','f','2020-12-25','08d4b492485',169,'123456901'),
(12,'Волкова', 'Полина', 'Геннадьевна','f','2016-01-22','696fcc8baedead',170,'45678429'),
(13,'Быкова', 'Екатерина', 'Евгеньевна','f','2012-10-07','63fc482caac0ccc6',171,'12345679'),
(14,'Коновалов', 'Андрей', 'Сергеевич','m','2019-07-28','d78ae8822ff7',172,'678987091'),
(15,'Базарова', 'Оксана', 'Александровна','f','2013-06-11','f1541b36b664',173,'9876593'),
(16,'Самойлов', 'Александр', 'Михайлович','m','2019-08-10','7014318b0634',174,'7637864'),
(17,'Белова', 'Вера', 'Егоровна','f','2011-12-14','dca7e2a9e63ea23d3e1d8',175,'3557181'),
(18,'Капустин', 'Евгений', 'Васильевич','m','2018-11-04','e57533be4276b918486',176,'7863958'),
(19,'Давыдова', 'Полина', 'Евгеньевна','f','2017-04-10','c92d761c87f9ea7',177,'2647805'),
(20,'Захарова', 'Лидия', 'Михайловна','f','2019-12-22','441d1bd57e072ac331',178,'8939743'),
(21,'Галкин', 'Андрей', 'Васильевич','m','2019-02-13','8e98e661e931e7',179,'9476569'),
(22,'Фомин', 'Георгий', 'Васильевич','m','2017-03-29','f29f08c72a6c19',180,'987653450'),
(23,'Крюков', 'Евгений', 'Семенович','m','2019-07-11','5f17afbf19fc522d6',181,'86550096'),
(24,'Ильина', 'Зоя', 'Александровна','f','2012-02-12','3c288d8af3b0e',182,'347887656'),
(14,'Коновалова', 'Лиана', 'Анатольевна','f','2018-05-03','aed6e7e772f8',183,'135007554'),
(26,'Юрьева', 'Валентина', 'Сергеевна','f','2016-08-20','0c9926bcde3',184,'797645422'),
(27,'Рожков', 'Никита', 'Денисович','m','2015-01-16','48e3623610371f',185,'1490461455'),
(28,'Ибрагимов', 'Аркадий', 'Семенович','m','2010-05-11','0d4ca0ae6cae042cc2756',186,'9638931'),
(29,'Логинов', 'Эдуард', 'Михайлович','m','2017-11-16','909ffc0b4b63f98',187,'94745975'),
 (30,'Репин', 'Виктор', 'Степанович','m','2019-07-16','3f114fd760169be',192,'98765456'),
 (31,'Лебедева', 'Маргарита', 'Артемовна','f','2019-12-16','c6384986',193,'9876685'),
(32,'Лазарев', 'Андрей', 'Андреевич','m','2015-01-09','efdb49d3415c',197,'8764561'),
(33,'Волков', 'Михаил', 'Александрович','m','2017-06-27','ba5736dba0a',198,'8269625'),
(34,'Бодров', 'Артем', 'Семенович','m','2018-05-12','89899a8ecf1',200,'79310540');




DROP TABLE IF EXISTS passport_id ;
CREATE TABLE passport_id (
    user_id SERIAL PRIMARY KEY,
    ser_num CHAR(50) UNIQUE NOT NULL,
    date_of DATE  COMMENT 'Дата выдачи',
    status_of_verification  ENUM('в обработке','принято','отказано'),
    code VARCHAR(100),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
 FOREIGN KEY (user_id) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
 INDEX passport_idx(ser_num),
 INDEX pass_st_idx(status_of_verification)
);

   INSERT INTO passport_id(user_id,ser_num,date_of,status_of_verification,code,created_at,updated_at) VALUES
   (1,'0315 567425','2015-01-09','принято','240-053','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (2,'0316 567425','2016-01-09','в обработке','240-066','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (3,'0317 567425','2009-01-09','принято','240-057','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (4,'0318 567425','2011-01-09','отказано','240-046','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (5,'0319 567425','2012-01-09','принято','240-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (6,'0312 567425','2013-01-09','принято','240-052','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (7,'0314 567425','2014-01-09','в обработке','260-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (8,'0311 567425','2015-01-09','принято','230-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (9,'0313 267425','2008-01-09','принято','240-086','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (10,'0313 367425','2011-01-09','отказано','270-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (11,'0913 567425','2008-01-09','принято','220-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (12,'0313 567425','2007-01-09','принято','240-054','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (13,'0313 667425','2003-01-09','принято','241-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (14,'0313 767425','2009-01-09','принято','242-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (15,'0313 867425','2015-03-09','в обработке','260-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (16,'0313 967425','2015-01-19','отказано','270-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (17,'0313 517425','2015-06-09','принято','240-076','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (18,'0313 527425','2018-01-09','принято','240-256','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (19,'0313 537425','2011-01-09','принято','243-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (20,'0319 547425','2005-01-09','в обработке','241-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (21,'0313 557425','2013-01-09','принято','248-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (22,'0313 577425','2007-01-09','принято','249-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (23,'0313 587425','2009-01-09','принято','240-066','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (24,'0313 597425','2010-01-09','принято','240-036','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (25,'0313 561425','2011-01-09','принято','250-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (26,'0313 562425','2012-01-09','в обработке','280-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (27,'0313 563425','2016-01-09','принято','245-086','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (28,'0313 564425','2019-01-09','принято','242-076','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
    (29,'0313 565425','2020-01-09','принято','230-036','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (30,'0313 566425','2012-01-09','принято','270-156','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (31,'0313 568425','2016-01-09','принято','250-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (32,'0313 569425','2012-01-09','в обработке','280-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (33,'0313 567125','2018-01-09','принято','240-053','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (34,'0313 567225','2019-01-09','принято','240-052','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (35,'0313 567325','2010-01-09','принято','246-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (36,'0313 567525','2005-01-09','в обработке','140-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (37,'0313 567625','2006-01-09','принято','240-856','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (38,'0313 567725','2007-01-09','принято','249-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (39,'0313 567825','2006-01-09','принято','247-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (40,'0313 567925','2011-01-09','принято','242-656','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (41,'0313 567415','2012-01-09','принято','240-856','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (42,'0313 567435','2013-01-09','в обработке','340-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (43,'0313 567445','2017-01-09','принято','340-156','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (44,'0313 567455','2019-01-09','принято','240-656','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (45,'0313 567465','2011-01-09','принято','240-756','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (46,'0313 567475','2017-01-09','принято','240-356','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (47,'0313 567485','2003-01-09','принято','241-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (48,'0313 567495','2000-01-09','принято','245-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (49,'0313 567421','2017-01-09','в обработке','240-076','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (50,'0313 567422','2015-01-09','принято','230-054','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (51,'0313 567423','2015-01-09','принято','220-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (52,'0313 567424','2015-01-09','принято','250-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (53,'0313 567426','2015-01-09','в обработке','270-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (54,'0313 567427','2015-01-09','принято','250-086','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (55,'0313 567428','2015-01-09','принято','230-256','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (56,'0313 567429','2015-01-09','принято','240-856','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
    (57,'0113 567425','2015-01-09','принято','242-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (58,'0323 567425','2015-01-09','в обработке','250-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (59,'0333 567425','2015-01-09','принято','280-056','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (60,'0343 567425','2015-01-09','принято','220-656','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (61,'0513 567425','2015-01-09','отказано','290-156','2019-08-24 05:48:41', '2020-02-13 02:19:21'),
   (62,'0613 567425','2015-01-09','принято','244-856','2019-08-24 05:48:41', '2020-02-13 02:19:21');
  
   
   
   
   
   


DROP TABLE IF EXISTS catalogs;
CREATE TABLE catalogs( 
    id SERIAL PRIMARY KEY,
    name_of VARCHAR(150),
    body VARCHAR(150),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
INDEX name_catalogs_idx(name_of)
);

INSERT INTO catalogs(name_of,body,created_at,updated_at) VALUES
('Распоряжение материнским капиталом',NULL,'2001-09-18 11:46:04', '2021-01-28 06:58:24'),
('Выдача государственного сертификата на материнский (семейный) капитал',NULL,'2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Регистрация рождения',NULL,'2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Регистрация брака',NULL,'2001-07-29 15:46:48','2021-03-21 18:09:00'),
('Ежемесячное пособие по уходу за ребенком',NULL,'2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Замена паспорта гражданина РФ', 'в случае изменения личных данных', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Замена паспорта РФ', 'в связи с достижением возраста 20 или 45 лет', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Замена паспорта РФ','в связи с непригодностью к использованию', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Замена паспорта РФ', 'в связи с обнаружением неточности или ошибочности записей', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Получение паспорта гражданина РФ', 'в случае достижения 14-летнего возраста', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Получение паспорта гражданина РФ', 'в случае приобретения гражданства Российской Федерации', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Получение паспорта гражданина РФ','в связи с хищением или утратой паспорта', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Регистрация гражданина','по месту жительства', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Регистрация гражданина', 'по месту пребывания в жилом помещении', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Снятие с регистрационного учета', 'по месту жительства', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Снятие гражданина с регистрационного учета', 'по месту пребывания', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Прием налоговых деклараций физических лиц (3-НДФЛ)',NULL, '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Запись в детский сад',NULL, '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Запись в образовательное учреждение',NULL,'2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Запись к врачу', NULL,'2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Вызов врача на дом', NULL,'2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Заявление о выплате','10 000 рублей на детей школьного возраста', '2021-07-29 15:46:48', '2021-09-21 18:09:00'),
('Ежемесячная выплата на детей', 'от 3 до 5 лет', '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Справка о размере пенсии и иных выплат ПФР',NULL, '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Получение пособия по безработице',NULL, '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Постановка на учет в центре занятости',NULL, '2001-07-29 15:46:48', '2021-03-21 18:09:00'),
('Пособие по временной нетрудоспособности',NULL, '2001-07-29 15:46:48', '2021-03-21 18:09:00');



 DROP TABLE IF EXISTS departments;
CREATE TABLE departments( 
     id SERIAL PRIMARY KEY,
     context_name VARCHAR(50),
     full_name VARCHAR(150),
     INDEX con_name_idx(context_name)
 );


INSERT INTO departments(context_name,full_name) VALUES
('МВД','Министерство внутренних дел Российской Федерации'),
('ФНС','Федеральная налоговая служба'),
('ФСС','Фонд социального страхования Российской Федерации'),
('ПФР','Пенсионный фонд Российской Федерации'),
('ФССП','Федеральная служба судебных приставов'),
('ГУВМ МВД','Главное управление по вопросам миграции МВД России'),
('МИНЗДРАВ','Министерство здравоохранения Российской Федерации'),
('РОСРЕЕСТР','Федеральная служба государственной регистрации, кадастра и картографии'),
('РОСПОТРЕБНАДЗОР','Федеральная служба по надзору в сфере защиты прав потребителей и благополучия человека'),
('РОСАВТОДОР','Федеральное дорожное агентство'),
('ЕДУ','Министерство просвещения Российской Федерации'),
('РОСТРУД','Федеральная служба по труду и занятости');






DROP TABLE IF EXISTS status;
CREATE TABLE status(
      id SERIAL PRIMARY KEY,
      name VARCHAR(50),
      body VARCHAR(150)   COMMENT 'Описание'
      );
     
  INSERT INTO status(name,body) VALUES
  ('Черновик заявления','Заявление редактируется пользователем'),
  ('Заявление в очереди на отправку','Для пользователя нет возможности редактировать заявления'),
  ('Заявление отправляется','Заявление передано в систему ведомства'),
  ('Зарегистрировано на портале	',NULL),
  ('Заявление отправлено в ведомство',NULL),
  ('Заявление получено ведомством',NULL),
  ('Промежуточные результаты по заявлению',NULL),	
  ('Ожидание информации','Ведомство запрашивает дополнительную информацию от заявителя'),
  ('Приглашение на прием по заявлению','Позволяет заявителю записаться на приём в ведомство'),
  ('Заявление отменяется','Заявитель сам отменил свое заявление'),
  ('Отказано в предоставлении услуги','Ваше заявление рассмотрено и по нему принято отрицательное решение'),
  ('Услуга оказана','Заявление удовлетворено ведомством');

 
 
 
 

 -- Записи/заявления
 
 DROP TABLE IF EXISTS statements; 
CREATE TABLE statements(
       id SERIAL PRIMARY KEY,
       from_user_id BIGINT UNSIGNED NOT NULL,
       catalogs_id  BIGINT UNSIGNED NOT NULL,
       departments_id BIGINT UNSIGNED NOT NULL,
       status_id BIGINT UNSIGNED NOT NULL,
       payment ENUM ('оплачено','неоплачено','бесплатная'),
       summ  INT UNSIGNED,
       created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
       updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (from_user_id) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
FOREIGN KEY (catalogs_id) REFERENCES catalogs(id) ON UPDATE CASCADE ON DELETE CASCADE,
FOREIGN KEY (departments_id) REFERENCES departments(id) ON UPDATE CASCADE ON DELETE CASCADE,
FOREIGN KEY (status_id) REFERENCES status(id) ON UPDATE CASCADE ON DELETE CASCADE,
INDEX pay_idx(payment)
);
    
INSERT INTO statements(from_user_id, catalogs_id, departments_id, status_id, payment, summ ,created_at, updated_at) VALUES
(1,12,1,4,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(2,21,7,9,'бесплатная','0','2020-06-06 19:28:28', '2021-09-15 23:00:55'),
(3,10,1,6,'оплачено','350','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(4,2,11,12,'оплачено','350','2019-06-06 19:28:28', '2021-09-15 23:00:55'),
(5,18,1,4,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(6,14,8,1,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(7,3,1,6,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(8,20,9,12,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(9,15,8,3,'оплачено','350','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(10,5,4,4,'оплачено','350','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(11,17,2,3,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(12,19,11,11,'неоплачено','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(13,9,4,1,'оплачено','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(14,22,4,12,'бесплатная','0','2018-06-06 19:28:28', '2021-09-15 23:00:55'),
(15,26,12,6,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(16,2,4,8,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(17,6,1,3,'оплачено','350','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(18,7,1,12,'оплачено','350','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(19,4,1,12,'оплачено','350','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(20,23,4,8,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(21,14,8,6,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(22,18,11,7,'оплачено','350','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(23,23,4,6,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(24,27,12,9,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(25,12,1,8,'оплачено','950','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(26,1,4,12,'бесплатная','0','2020-06-06 19:28:28', '2021-09-15 23:00:55'),
(27,8,1,5,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(28,17,2,6,'оплачено','780','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(29,26,12,4,'оплачено','560','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(30,20,7,9,'оплачено','780','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(31,2,4,7,'оплачено','1200','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(32,11,1,12,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(33,13,8,6,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(34,14,8,6,'неоплачено','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(35,23,4,4,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(36,3,1,8,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(37,4,1,11,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(38,22,4,12,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(39,12,1,11,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(40,7,1,3,'оплачено','250','2021-08-06 19:28:28', '2021-09-15 23:00:55'),
(41,9,1,9,'оплачено','800','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(42,19,11,12,'оплачено','310','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(43,15,8,5,'оплачено','670','2021-08-06 19:28:28', '2021-09-15 23:00:55'),
(44,24,4,7,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(45,27,12,9,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(45,3,1,12,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(46,21,7,12,'оплачено','790','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(47,12,1,9,'оплачено','830','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(48,12,1,9,'оплачено','1115','2021-08-06 19:28:28', '2021-09-15 23:00:55'),
(49,23,4,12,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(50,1,1,11,'неоплачено','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(51,8,1,1,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(52,20,7,4,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(53,13,8,12,'бесплатная','0','2021-10-06 19:28:28', '2021-09-15 23:00:55'),
(54,14,8,7,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(55,18,11,3,'оплачено','1250','2021-08-06 19:28:28', '2021-09-15 23:00:55'),
(56,23,4,9,'бесплатная','0','2021-07-06 19:28:28', '2021-09-15 23:00:55'),
(57,27,12,6,'бесплатная','0','2021-01-06 19:28:28', '2021-09-15 23:00:55'),
(58,12,1,12,'оплачено','390','2021-02-06 19:28:28', '2021-09-15 23:00:55'),
(59,1,4,6,'бесплатная','0','2021-02-06 19:28:28', '2021-09-15 23:00:55'),
(60,8,1,5,'бесплатная','0','2021-03-06 19:28:28', '2021-09-15 23:00:55'),
(61,17,2,6,'оплачено','2150','2021-08-06 19:28:28', '2021-09-15 23:00:55'),
(62,26,12,4,'оплачено','780','2021-04-06 19:28:28', '2021-09-15 23:00:55'),
(11,20,7,9,'оплачено','780','2021-05-06 19:28:28', '2021-09-15 23:00:55'),
(14,2,4,7,'оплачено','540','2021-07-06 19:28:28', '2021-09-15 23:00:55'),
(47,11,1,12,'бесплатная','0','2021-07-06 19:28:28', '2021-09-15 23:00:55'),
(2,13,8,6,'бесплатная','0','2021-01-06 19:28:28', '2021-09-15 23:00:55'),
(3,14,8,6,'неоплачено','0','2021-01-06 19:28:28', '2021-09-15 23:00:55'),
(5,23,4,4,'бесплатная','0','2021-02-06 19:28:28', '2021-09-15 23:00:55'),
(6,3,1,8,'бесплатная','0','2021-05-06 19:28:28', '2021-09-15 23:00:55'),
(27,22,4,11,'бесплатная','0','2021-05-06 19:28:28', '2021-09-15 23:00:55'),
(8,22,4,12,'бесплатная','0','2021-04-06 19:28:28', '2021-09-15 23:00:55'),
(15,22,4,7,'бесплатная','0','2021-09-06 19:28:28', '2021-09-15 23:00:55'),
(10,7,1,3,'оплачено','340','2021-08-08 19:28:28', '2021-09-15 23:00:55'),
(11,9,1,9,'оплачено','2000','2021-08-06 19:28:28', '2021-09-15 23:00:55'),
(12,19,11,12,'оплачено','1170','2021-01-06 19:28:28', '2021-09-15 23:00:55'),
(13,15,8,5,'оплачено','720','2021-02-06 19:28:28', '2021-09-15 23:00:55'),
(15,22,4,11,'бесплатная','0','2021-03-06 19:28:28', '2021-09-15 23:00:55'),
(7,15,8,3,'оплачено','890','2021-03-06 19:28:28', '2021-09-15 23:00:55'),
(9,22,4,4,'оплачено','450','2021-04-06 19:28:28', '2021-09-15 23:00:55'),
(16,17,2,3,'бесплатная','0','2021-06-08 19:28:28', '2021-09-15 23:00:55'),
(11,19,11,11,'неоплачено','0','2021-07-06 19:28:28', '2021-09-15 23:00:55'),
(33,9,4,1,'оплачено','320','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(1,22,4,12,'бесплатная','0','2021-06-06 19:28:28', '2021-09-15 23:00:55'),
(8,26,12,6,'бесплатная','0','2021-08-06 19:28:28', '2021-09-15 23:00:55'),
(19,2,4,8,'бесплатная','0','2021-07-06 19:28:28', '2021-0-15 23:00:55'),
(22,6,1,3,'оплачено','900','2021-05-06 19:28:28', '2021-09-15 23:00:55'),
(17,22,4,9,'оплачено','520','2021-02-06 19:28:28', '2021-09-15 23:00:55'),
(9,4,1,12,'оплачено','1430','2021-01-06 19:28:28', '2021-09-15 23:00:55');






-- Задолженности по пользователям

 DROP TABLE IF EXISTS debt; 
CREATE TABLE debt(
    id SERIAL PRIMARY KEY,
    to_user_id  BIGINT UNSIGNED NOT NULL,
    from_departments_id  BIGINT UNSIGNED NOT NULL,
    body VARCHAR(150),
    duty_summ INT NOT NULL, 
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
FOREIGN KEY (from_departments_id) REFERENCES departments(id) ON UPDATE CASCADE ON DELETE CASCADE,
FOREIGN KEY (to_user_id) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
INDEX duty_summ_idx(duty_summ)
);

 INSERT INTO debt(to_user_id,from_departments_id,body,duty_summ,created_at) VALUES
(29,2,'Оплата налоговых задолженностей', '21000','2021-09-15 23:00:55'),
(30,7,'Счет за услуги','500', '2021-09-15 23:00:55'),
(31,4,'Государственная пошлина','250', '2021-09-15 23:00:55'),
(32,1,'Государственная пошлина','1500', '2021-09-15 23:00:55'),
(33,8,'Государственная пошлина','1200', '2021-09-15 23:00:55'),
(34,8,'Государственная пошлина','600','2021-06-06 19:28:28' ),
(35,4,'Государственная пошлина','750','2021-06-06 19:28:28'),
(36,3,'Штраф','100','2021-06-06 19:28:28'),
(37,1,'Государственная пошлина','1000','2021-06-06 19:28:28'),
(38,4,'Государственная пошлина','2000','2021-09-15 23:00:55'),
(39,1,'Государственная пошлина','500','2021-06-06 19:28:28'),
(40,5,'Судебная задолженность','9000','2021-09-15 23:00:55'),
(41,9,'Штраф','2500','2021-06-06 19:28:28' ),
(42,11,'Государственная пошлина','1600','2021-06-06 19:28:28'),
(43,6,'Государственная пошлина','500','2021-09-15 23:00:55'),
(44,2,'Оплата налоговых задолженностей','2500','2021-06-06 19:28:28'),
(45,2,'Оплата налоговых задолженностей','13000','2021-09-15 23:00:55'),
(45,1,'Государственная пошлина','200','2021-06-06 19:28:28'),
(46,12,'Штраф','100','2021-09-15 23:00:55'),
(47,1,'Государственная пошлина','500','2021-06-06 19:28:28'),
(48,5,'Судебная задолженность','93000', '2021-09-15 23:00:55'),
(49,2,'Оплата налоговых задолженностей','8000','2021-09-15 23:00:55'),
(50,11, 'Счет за услуги','750','2021-06-06 19:28:28'),
(2,5,'Судебная задолженность','12000', '2021-10-15 23:00:55'),
(30,3,'Судебная задолженность','63140','2021-07-15 23:00:55'),
(12,4,'Государственная пошлина','300', '2021-09-15 23:00:55'),
(7,1,'Государственная пошлина','200', '2021-09-15 23:00:55'),
(19,8,'Государственная пошлина','1200', '2021-09-15 23:00:55'),
(5,2,'Оплата налоговых задолженностей','12300','2021-06-06 19:28:28' ),
(9,4,'Счет за услуги','500','2021-06-06 19:28:28'),
(23,3,'Штраф','150','2021-06-06 19:28:28'),
(11,1,'Государственная пошлина','1000','2021-06-06 19:28:28'),
(29,2,'Оплата налоговых задолженностей','4800', '2021-09-15 23:00:55'),
(10,7,'Счет за услуги','450', '2021-09-15 23:00:55'),
(23,4,'Государственная пошлина', '150','2021-09-15 23:00:55'),
(32,1,'Государственная пошлина','1500','2021-09-15 23:00:55'),
(3,8,'Государственная пошлина','200','2021-09-15 23:00:55'),
(4,2,'Оплата налоговых задолженностей','5200','2021-06-06 19:28:28' ),
(9,5,'Судебная задолженность','5900','2021-06-06 19:28:28'),
(12,3,'Счет за услуги','350','2021-06-06 19:28:28'),
(15,1,'Государственная пошлина','350','2021-06-06 19:28:28'),
(18,4,'Штраф','200','2021-09-15 23:00:55'),
(42,1,'Государственная пошлина','920','2021-06-06 19:28:28'),
(2,1,'Государственная пошлина','1200','2021-09-15 23:00:55'),
(1,9,'Штраф','5000','2021-06-06 19:28:28' ),
(13,2,'Оплата налоговых задолженностей','13000','2021-09-15 23:00:55'),
(14,1,'Государственная пошлина','200','2021-06-06 19:28:28'),
(6,12,'Штраф','100','2021-09-15 23:00:55'),
(7,1,'Государственная пошлина','500','2021-06-06 19:28:28'),
(8,5,'Судебная задолженность','93000', '2021-09-15 23:00:55'),
(55,2,'Оплата налоговых задолженностей','8000','2021-09-15 23:00:55'),
(50,11, 'Счет за услуги','750','2021-06-06 19:28:28'),
(62,5,'Судебная задолженность','12000', '2021-10-15 23:00:55'),
(61,3,'Судебная задолженность','63140','2021-07-15 23:00:55'),
(59,4,'Государственная пошлина','300', '2021-09-15 23:00:55'),
(60,1,'Государственная пошлина','200', '2021-09-15 23:00:55'),
(29,8,'Государственная пошлина','1200', '2021-09-15 23:00:55'),
(56,2,'Оплата налоговых задолженностей','12300','2021-06-06 19:28:28' ),
(49,4,'Счет за услуги','500','2021-06-06 19:28:28'),
(13,3,'Штраф','150','2021-06-06 19:28:28'),
(31,1,'Государственная пошлина','1000','2021-06-06 19:28:28'),
(9,2,'Оплата налоговых задолженностей','4800', '2021-09-15 23:00:55'),
(19,7,'Счет за услуги','450', '2021-09-15 23:00:55'),
(54,4,'Государственная пошлина','350', '2021-09-15 23:00:55'),
(39,1,'Государственная пошлина','1500','2021-09-15 23:00:55'),
(8,8,'Государственная пошлина','200','2021-09-15 23:00:55'),
(14,2,'Оплата налоговых задолженностей','5200','2021-06-06 19:28:28' ),
(18,5,'Судебная задолженность','5900','2021-06-06 19:28:28'),
(2,3,'Счет за услуги','350','2021-06-06 19:28:28'),
(5,1,'Государственная пошлина','350','2021-06-06 19:28:28');




	


-- 1.
---- Найти пользователей с принятым паспортом(прошедшие регистрацию на госуслугах), 
-- их заявления со статусом "3", 
--- где оплата = "оплачено"/"бесплатно" 
-- и указать id нужного нам департамента (пусть для примера будет departments.id = 1)- для дальнейшей отправки в департамент по заявлению
	
SELECT pass.user_id as id, 
	CONCAT(u.lastname,' ',u.firstname,' ',u.patronymic) as 'ФИО',
	s.id 'заявление_id',
	s.payment 'оплата',
    d.context_name as 'Департамент'
FROM passport_id pass
JOIN users u  ON  pass.user_id= u.id
JOIN statements s ON pass.user_id = s.from_user_id 
JOIN departments d ON (s.departments_id = d.id AND d.id=1)
WHERE pass.status_of_verification ='принято'
AND  s.payment ='оплачено'or s.payment ='бесплатно'
AND s.status_id = 3
;
	
-- 2.Запрос, позволяющий увидеть суммы задолженностей по каждому виду у заданного пользователя.

SELECT u.id,
	SUM(deb.duty_summ) as summa_duty,
	IF(deb.body IS NULL, 'Нет задолженностей',deb.body) as 'name_duty'
	FROM debt deb
	RIGHT JOIN users u 
	ON deb.to_user_id=u.id
    WHERE u.id =32
	GROUP BY deb.body;
  
  -- 3. Сколько заявлений со статусом = 12 ("услуга оказана") по каждому региону.
 
   SELECT 
     r.region,
     s.name,
     COUNT(st.id) as total
     FROM region r   
     JOIN users u ON r.id= u.region_id 
     JOIN statements st ON u.id= st.from_user_id
     JOIN status s ON st.status_id = s.id AND s.id=12
   GROUP BY r.id
   ORDER BY total DESC;
  
  
  -- 4. Посчитать сумму оплаченных заявлений ,  макс чек и мин чек по категориям: мужчины/женщины.
  
   SELECT 
  st.id,
   (SELECT CASE (u.gender)
        WHEN 'm' THEN 'мужчины'
        WHEN 'f' THEN 'женщины'
        ELSE 'другой' END) as 'пол',
  SUM(st.summ),
  MAX(st.summ),
  MIN(st.summ)
  FROM statements st
  JOIN users u ON st.from_user_id = u.id 
  WHERE st.payment = 'оплачено'
  GROUP BY u.gender;
 



 
-- 5. Найти ФИО детей,для начисления выплаты их представителям(родителям),которые подали заявление(22) на выплату(статус заявления 
-- не равен 12(исполнен) и не равен 11(отказано)
  --- Возраст не привышает 14 лет, свыше 14ти по паспорту дети сами проходят регистрацию)

  SELECT 
 st.id as 'id заявления',
 st.from_user_id as 'родитель',
 sn.number_of as 'номер СНИЛС ребенка',
 CONCAT(ch.lastname,' ',ch.firstname,' ',ch.patronymic) as 'ФИО ребенка', 
 ch.id as 'id ребенка',
 ch.birthday
 FROM statements st 
 JOIN catalogs cat ON st.catalogs_id= cat.id AND cat.id = 22
 JOIN children ch ON st.from_user_id= ch.user_id
 JOIN snils sn ON ch.snils_id= sn.id
 JOIN status s ON st.status_id=s.id AND st.status_id < 11
 
 WHERE  YEAR(ch.birthday) BETWEEN (YEAR(NOW())-14) AND (YEAR(NOW())-6)
AND sn.status_of_verification = 'принято' ;




-- 6. Количество заявлений по статусу оплаты (в процентах).

SELECT payment,
COUNT(id) as total,
CONCAT(ROUND((SELECT COUNT(id)*100)/(SELECT COUNT(id) FROM statements)),'%') as pr_from_total
FROM statements
WHERE payment = 'оплачено' 
UNION
SELECT payment,
COUNT(id) as total,
CONCAT(ROUND((SELECT COUNT(id)*100)/(SELECT COUNT(id) FROM statements)),'%') as pr_from_total
FROM statements
WHERE payment = 'неоплачено' 
UNION
SELECT payment,
COUNT(id) as total,
CONCAT(ROUND((SELECT COUNT(id)*100)/(SELECT COUNT(id) FROM statements)),'%') as pr_from_total
FROM statements
WHERE payment = 'бесплатная' ;



-- Представление, в котором выводятся пользователи чей снилс и паспорт "принят"(наиболее популярный запрос)
DROP VIEW  IF EXISTS users_pass_sn_ok ;
CREATE VIEW users_pass_sn_ok 
as 
SELECT u.id as id_user,
       CONCAT(u.lastname,' ',u.firstname,' ',u.patronymic) as 'ФИО',
       sn.id as id_snils,
       sn.number_of,
       pass.user_id as id_passport,
       pass.ser_num
       FROM users u
       JOIN passport_id pass ON u.id = pass.user_id 
       JOIN snils sn ON u.snils_id= sn.id
WHERE pass.status_of_verification ='принято'
AND sn.status_of_verification ='принято';


 -- Представление, в котором показываются пользователи, id их заявлений, инициалы департамента(указанного в заявлении) статус оплаты, 
--  сумма оплаты - по заданному региону(Ростовская область). Позволит производить расчеты и выборку отдельно по указанному региону.

DROP VIEW  IF EXISTS st_from_Rostov_obl ;
CREATE VIEW st_from_Rostov_obl
as
SELECT st.id as id_statement ,
st.from_user_id as id_user,
st.payment,
st.summ as summa,
d.context_name,
r.region 
FROM statements st
JOIN users u ON st.from_user_id = u.id
JOIN region r ON u.region_id = r.id
JOIN departments d ON st.departments_id=d.id
WHERE r.region = 'Ростовская область';

-- Пример,посчитать сумму общую оплаченных заялений по данной области.
-- Если каждая область закреплена за опред. оператором - возможность настроить доступ, сделав представления по каждой области

SELECT  SUM(summa) FROM st_from_Rostov_obl;
        



	

	
-- Хранимая процедура,позволяющая выполнить поиск по серии/номеру паспорта
	CALL sp_user('0319 567425');
 
 
--- Хранимая процедура,с использованием представления по зарегистрированным пользователям(с подтвержденным паспортом) 
--- для подсчета сумм по видам задолженности.

    CALL sp_total_dedt; 
   
   
   --- Триггер, если удаляется пользователь, удаляются и все заявления от него.
   
DROP TRIGGER IF EXISTS check_user_id_from_st ;

DELIMITER //
 
CREATE TRIGGER check_user_id_from_st AFTER DELETE ON users
FOR EACH ROW
BEGIN
DELETE FROM statements WHERE from_user_id= OLD.id;

END//
DELIMITER ;





--- Триггер, который не допускает NULL в имени при вставке нового пользователя.
 
 DROP TRIGGER IF EXISTS check_user_firstlastname ;

DELIMITER //

CREATE TRIGGER check_user_firstlastname BEFORE INSERT ON users
FOR EACH ROW
BEGIN
	IF(NEW.lastname IS NULL  
	  OR
	  NEW.firstname IS NULL 
	OR
	  NEW.birthday IS NULL ) THEN
	SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT =  'Ошибка!Вы должны заполнить все поля';
	END IF;
END //
DELIMITER ;
 
 

 